/*! asg.js 2016-02-19 */
!function(a){var b="asg",c=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=!1,A=a.extend({namespace:"asg",classes:[],callback:function(){},source:null,delay:300,minChars:1,offsetTop:7,putAbove:!1,putLeft:!1,numToSuggest:10,leadingWildcard:!1,staticPos:!1,footer:null,boldMatches:!1,clickEvent:"click",delimiter:"",keysInInput:!1},c),B=A.namespace,C=A.container,D={keyup:[],change:[]},E={};return l=function(){return d=b,a.isArray(A.source)&&(A.source=r(A.source)),A.putAbove&&A.classes.push("above"),A.putLeft&&A.classes.push("left"),m(),q(),E},r=function(a){var b,c;if(!a.length)return a;if("string"==typeof a[0])for(b=0;b<a.length;b++)a[b]={key:a[b],value:a[b]};else if(!a[0].key||!a[0].value)for(b=0;b<a.length;b++)c=a[b].key||a[b].value,a[b].key=a[b].value=c;return a},m=function(){var b=A.classes.join(" ");if(e=a('<div class="'+B+"-suggestions "+b+'"><ul class="'+B+'-ul"></ul></div>'),A.noHide||e.hide(),A.footer){var c=A.footer;c=c.jquery?c:a(c),e.append(c)}e.appendTo(C||a("body")),f=e.find("."+B+"-ul")},n=function(){A.callback()},s=function(){if(!A.staticPos){var b={},c=d.offset();A.putAbove?b.top=c.top-(11+A.offsetTop+e.height()):A.fixed?b.top=c.top-a(window).scrollTop()+20+A.offsetTop:b.top=c.top+20+A.offsetTop,A.putLeft?b.left=c.left+5+d.width()-e.width():b.left=c.left,e.css(b)}},y=function(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):a},o=function(b,c){if(f.empty(),z=!1,b&&b.length){var d,g,h,i=a("<ul/>"),j=A.numToSuggest||1e3,k=new RegExp("("+c+")","i");for(d=0;d<b.length&&j>d;d++)g=b[d],h=g.verbatim?"&#8220;"+y(g.value)+"&#8221;":y(g.value),A.boldMatches&&(h=h.replace(k,'<span class="'+B+'-matched">$1</span>')),a('<li class="'+B+'-li"><span class="'+B+"-img-wrap "+(g.img?"":B+"-no-img")+'">'+(g.img?'<img class="'+B+'-img" src="'+g.img+'">':"")+'</span><span class="'+B+'-label" tabindex="-1">'+h+"</span></li>").data(B+"-data",g)[A.putAbove?"prependTo":"appendTo"](i).find("."+B+"-img").load(s);f.append(i.children()),s(),z=!0}A.noHide||e[z?"show":"hide"]()},p=function(){var b,c,e=A.source,f=[],g=v(d.val(),d[0].selectionStart),h=function(a){c<p.latest||j||(i&&(a||[]).length?(E.set(0,0,a[0]),n()):o(r(a),v(d.val(),d[0].selectionStart)))},k=new RegExp((A.leadingWildcard?"":"^")+g,"i");if(j=0,g||!A.minChars)if(e)if(a.isArray(e)){for(b=0;b<e.length;b++)e[b].value.match(k)&&f.push(e[b]);o(f)}else a.isFunction(e)&&(c=++p.latest,e(null,g,h));else E.set(g,g),n()},p.latest=0,x=function(a,b){for(var c=b,d=b;c>0&&a[c-1]!==A.delimiter;)c--;for(;d<a.length&&a[d]!==A.delimiter;)d++;return[c,d]},v=function(a,b){if(!A.delimiter)return a;var c=x(a,b);return a.substr(c[0],c[1]-c[0])},w=function(a){if(!A.delimiter)return void d.val(a);var b=d.val(),c=x(b,d[0].selectionStart);b=b.substr(0,c[0])+a+b.substr(c[1]),d.val(b)},q=function(){d.on("change."+B,function(a){for(var b=0,c=D.change.length;c>b;b++)D.change[b].call(d,a);d.val()?A.source||(j&&(j=clearTimeout(j)),j=setTimeout(p,A.delay)):n()}).on("keydown."+B,u).on("keyup."+B,t).on("click."+B,t).on("blur."+B,function(){A.noHide||(k=setTimeout(o,300))}).on("focus."+B,function(){i=0,A.noHide||(k&&(k=clearTimeout(k)),E.get()||!d.val()&&A.minChars||p())}),e.on(A.clickEvent,"li",function(){E.set(0,0,a(this).data(B+"-data")),n()})},t=function(a){a=a||window.event;for(var b=0,c=D.keyup.length;c>b;b++)D.keyup[b].call(d,a);var f,k=j,l=d.val(),m=v(l,d[0].selectionStart);if(i=0,l!==g||m!==h||13===a.which){if(E.set(),g=l,h=m,!l&&A.minChars)return void o();j&&(j=clearTimeout(j)),13===a.which?(a.preventDefault&&a.preventDefault(),f=e.find("li.sel"),k||f.length||(f=e.find("."+B+"-li:"+(A.putAbove?"last":"first")+"-child")),!k&&f.length?(E.set(0,0,f.data(B+"-data")),n()):(i=1,j=setTimeout(p,A.delay)),o()):d.val().length>=A.minChars?j=setTimeout(p,A.delay):o()}},u=function(a){if(a=a||window.event,!z)return!0;var b=e.find("li.sel");switch(b.length||(b=e.find("li:hover")),a.which){case 38:b.removeClass("sel"),a.preventDefault&&a.preventDefault(),b.length&&b.prev().length?b.prev().addClass("sel"):e.find("ul li:last-child").addClass("sel");break;case 40:b.removeClass("sel"),a.preventDefault&&a.preventDefault(),b.length&&b.next().length?b.next().addClass("sel"):e.find("ul li:first-child").addClass("sel");break;case 27:case 9:o()}},E.get=function(){var a=d.data(B+"-data");return a&&a.key&&a.value?a:void 0},E.set=function(b,c,e,f){e=e||{key:b,value:c};var g,h=A.source;if(e.value&&e.key)d.data(B+"-data",e),w(A.keysInInput?e.key:e.value),(f||a.noop)();else if(e.key)if(e.value=e.key,d.val("...").data(B+"-data",e),a.isArray(h)){var i=!1;for(g=0;g<h.length;g++)if(h[g].key===e.key){E.set(h[g].key,h[g].value),i=!0;break}i?(f||a.noop)():E.clear()}else h(e.key,null,function(b){1===b.length?(b=r(b),E.set(0,0,b[0]),(f||a.noop)()):E.clear()});else d.data(B+"-data",null)},E.clear=function(){d.val("").data(B+"-data",null)},E.destroy=function(){e.remove(),d.data(B+"-data",null).off("."+B)},E.on=function(a,b){D[a].push(b)},E.fixed=function(){e.addClass("asg-fixed"),A.fixed=!0},E.suggest=p,l(b)};a.fn[b]=a.fn[b.toUpperCase()]=function(d){var e=this.data(b);return d&&"object"!=typeof d?e?e[d].apply(e,Array.prototype.slice.call(arguments,1)):void a.error('Cannot call "'+d+'" - Autosuggest not initialized.'):e||this.data(b,c(this,d))}}((window.FTB||{}).$||window.jQuery);