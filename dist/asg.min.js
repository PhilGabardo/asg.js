/*! asg.js 2015-04-08 */
!function(a){var b="asg",c=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=!1,v=a.extend({namespace:"asg",classes:[],callback:function(){},source:null,delay:300,minChars:1,offsetTop:7,putAbove:!1,putLeft:!1,numToSuggest:10,leadingWildcard:!1,staticPos:!1,footer:null,boldMatches:!1,clickEvent:"click"},c),w=v.namespace,x=v.container,y={keyup:[],change:[]},z={};return k=function(){return d=b,a.isArray(v.source)&&(v.source=q(v.source)),v.putAbove&&v.classes.push("above"),v.putLeft&&v.classes.push("left"),l(),p(),z},q=function(a){var b,c;if(!a.length)return a;if("string"==typeof a[0])for(b=0;b<a.length;b++)a[b]={key:a[b],value:a[b]};else if(!a[0].key||!a[0].value)for(b=0;b<a.length;b++)c=a[b].key||a[b].value,a[b].key=a[b].value=c;return a},l=function(){var b=v.classes.join(" ");if(e=a('<div class="'+w+"-suggestions "+b+'"><ul class="'+w+'-ul"></ul></div>'),v.noHide||e.hide(),v.footer){var c=v.footer;c=c.jquery?c:a(c),e.append(c)}e.appendTo(x||a("body")),f=e.find("."+w+"-ul")},m=function(){v.callback()},r=function(){if(!v.staticPos){var b={},c=d.offset();b.top=v.putAbove?c.top-(11+v.offsetTop+e.height()):v.fixed?c.top-a(window).scrollTop()+20+v.offsetTop:c.top+20+v.offsetTop,b.left=v.putLeft?c.left+5+d.width()-e.width():c.left,e.css(b)}},n=function(b,c){if(f.empty(),u=!1,b&&b.length){var d,g,h,i=a("<ul/>"),j=v.numToSuggest||1e3,k=new RegExp("("+c+")","i");for(d=0;d<b.length&&j>d;d++)g=b[d],h=g.verbatim?"&#8220;"+g.value+"&#8221;":g.value,v.boldMatches&&(h=h.replace(k,'<span class="'+w+'-matched">$1</span>')),a('<li class="'+w+'-li"><span class="'+w+"-img-wrap "+(g.img?"":w+"-no-img")+'">'+(g.img?'<img class="'+w+'-img" src="'+g.img+'">':"")+'</span><span class="'+w+'-label" tabindex="-1">'+h+"</span></li>").data(w+"-data",g)[v.putAbove?"prependTo":"appendTo"](i).find("."+w+"-img").load(r);f.append(i.children()),r(),u=!0}v.noHide||e[u?"show":"hide"]()},o=function(){var b,c,e=v.source,f=[],g=d.val(),j=function(a){c<o.latest||i||(h&&(a||[]).length?(z.set(0,0,a[0]),m()):n(q(a),g))},k=new RegExp((v.leadingWildcard?"":"^")+g,"i");if(i=0,g||!v.minChars)if(e)if(a.isArray(e)){for(b=0;b<e.length;b++)e[b].value.match(k)&&f.push(e[b]);n(f)}else a.isFunction(e)&&(c=++o.latest,e(null,g,j));else z.set(g,g),m()},o.latest=0,p=function(){d.on("change."+w,function(a){for(var b=0,c=y.change.length;c>b;b++)y.change[b].call(d,a);d.val()?v.source||(i&&(i=clearTimeout(i)),i=setTimeout(o,v.delay)):m()}).on("keydown."+w,t).on("keyup."+w,s).on("blur."+w,function(){v.noHide||(j=setTimeout(n,300))}).on("focus."+w,function(){h=0,v.noHide||(j&&(j=clearTimeout(j)),z.get()||!d.val()&&v.minChars||o())}),e.on(v.clickEvent,"li",function(){z.set(0,0,a(this).data(w+"-data")),m()})},s=function(a){a=a||window.event;for(var b=0,c=y.keyup.length;c>b;b++)y.keyup[b].call(d,a);var f,j,k=i,l=d.val();if(h=0,l!==g||13===a.which){if(j=!!z.get(),z.set(),g=l,!l&&v.minChars)return void n();i&&(i=clearTimeout(i)),13===a.which?(a.preventDefault&&a.preventDefault(),f=e.find("li.sel"),k||f.length||(f=e.find("."+w+"-li:"+(v.putAbove?"last":"first")+"-child")),!k&&f.length?(z.set(0,0,f.data(w+"-data")),m()):(h=1,i=setTimeout(o,v.delay)),n()):d.val().length>=v.minChars?i=setTimeout(o,v.delay):n()}},t=function(a){if(a=a||window.event,!u)return!0;var b=e.find("li.sel");switch(b.length||(b=e.find("li:hover")),a.which){case 38:b.removeClass("sel"),a.preventDefault&&a.preventDefault(),b.length&&b.prev().length?b.prev().addClass("sel"):e.find("ul li:last-child").addClass("sel");break;case 40:b.removeClass("sel"),a.preventDefault&&a.preventDefault(),b.length&&b.next().length?b.next().addClass("sel"):e.find("ul li:first-child").addClass("sel");break;case 27:case 9:n()}},z.get=function(){var a=d.data(w+"-data");return a&&a.key&&a.value?a:void 0},z.set=function(b,c,e,f){e=e||{key:b,value:c};var g,h=v.source;if(e.value&&e.key)d.val(e.value).data(w+"-data",e),(f||a.noop)();else if(e.key)if(e.value=e.key,d.val("...").data(w+"-data",e),a.isArray(h)){var i=!1;for(g=0;g<h.length;g++)if(h[g].key===e.key){z.set(h[g].key,h[g].value),i=!0;break}i?(f||a.noop)():z.clear()}else h(e.key,null,function(b){1===b.length?(b=q(b),z.set(0,0,b[0]),(f||a.noop)()):z.clear()});else d.data(w+"-data",null)},z.clear=function(){d.val("").data(w+"-data",null)},z.destroy=function(){e.remove(),d.data(w+"-data",null).off("."+w)},z.on=function(a,b){y[a].push(b)},z.fixed=function(){e.addClass("asg-fixed"),v.fixed=!0},z.suggest=o,k(b)};a.fn[b]=a.fn[b.toUpperCase()]=function(d){var e=this.data(b);return d&&"object"!=typeof d?e?e[d].apply(e,Array.prototype.slice.call(arguments,1)):void a.error('Cannot call "'+d+'" - Autosuggest not initialized.'):e||this.data(b,c(this,d))}}((window.FTB||{}).$||window.jQuery);