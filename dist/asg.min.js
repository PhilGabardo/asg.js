(function(b){var a="asg";var c=function(i,f){var q,t,d,z=false,k=b.extend({namespace:"asg",classes:[],callback:function(){},source:null,delay:300,minChars:1,offsetTop:7,putAbove:false,putLeft:false,numToSuggest:10,leadingWildcard:false,staticPos:false,footer:null},f),A=k.namespace,r=k.container,j,n,y,m,v={keyup:[],change:[]},u={};var w,B,p,l,o,h,x,g,e,s;w=function(){q=i;if(b.isArray(k.source)){k.source=x(k.source)}if(k.putAbove){k.classes.push("above")}if(k.putLeft){k.classes.push("left")}B();h();return u};x=function(E){var D,C;if(!E.length){return E}else{if(typeof E[0]==="string"){for(D=0;D<E.length;D++){E[D]={key:E[D],value:E[D]}}}else{if(!E[0].key||!E[0].value){for(D=0;D<E.length;D++){C=E[D].key||E[D].value;E[D].key=E[D].value=C}}}}return E};B=function(){var D=k.classes.join(" ");t=b('<div class="'+A+"-suggestions "+D+'"><ul class="'+A+'-ul"></ul></div>');if(!k.noHide){t.hide()}if(k.footer){var C=k.footer;C=C.jquery?C:b(C);t.append(C)}t.appendTo(r||b("body"));d=t.find("."+A+"-ul")};p=function(){k.callback()};g=function(){if(k.staticPos){return}var D={},C=q.offset();if(k.putAbove){D.top=C.top-(11+k.offsetTop+t.height())}else{D.top=C.top+20+k.offsetTop}if(k.putLeft){D.left=C.left+5+q.width()-t.width()}else{D.left=C.left}t.css(D)};l=function(G){d.empty();z=false;if(G&&G.length){var F,H,E,D=b("<ul/>"),C=k.numToSuggest||1000;for(F=0;F<G.length&&F<C;F++){H=G[F];E=H.verbatim?("&#8220;"+H.value+"&#8221;"):H.value;b('<li class="'+A+'-li"><span class="'+A+'-img-wrap">'+(H.img?'<img class="'+A+'-img" src="'+H.img+'">':"")+'</span><span class="'+A+'-label" tabindex="-1">'+E+"</span></li>").data(A+"-data",H)[k.putAbove?"prependTo":"appendTo"](D).find("."+A+"-img").load(g)}d.append(D.children());g();z=true}if(!k.noHide){t[z?"show":"hide"]()}};o=function(){var E,C,I=k.source,D=[],H=q.val(),G=function(J){if(C<o.latest||y){return}else{if(n&&(J||[]).length){u.set(0,0,J[0]);p()}else{l(x(J))}}},F=new RegExp((k.leadingWildcard?"":"^")+H,"i");y=0;if(!H&&k.minChars){return}else{if(!I){u.set(H,H);p()}else{if(b.isArray(I)){for(E=0;E<I.length;E++){if(I[E].value.match(F)){D.push(I[E])}}l(D)}else{if(b.isFunction(I)){C=++o.latest;I(null,H,G)}}}}};o.latest=0;h=function(){q.on("change."+A,function(E){for(var D=0,C=v.change.length;D<C;D++){v.change[D].call(q,E)}if(!q.val()){p()}else{if(!k.source){if(y){y=clearTimeout(y)}y=setTimeout(o,k.delay)}}}).on("keydown."+A,s).on("keyup."+A,e).on("blur."+A,function(){if(!k.noHide){m=setTimeout(l,300)}}).on("focus."+A,function(){n=0;if(k.noHide){return}if(m){m=clearTimeout(m)}if(!u.get()&&(q.val()||!k.minChars)){o()}});t.on("click","li",function(){u.set(0,0,b(this).data(A+"-data"));p()})};e=function(I){I=I||window.event;for(var E=0,C=v.keyup.length;E<C;E++){v.keyup[E].call(q,I)}var H,F,D=y,G=q.val();n=0;if(G===j&&I.which!==13){return}F=!!u.get();u.set();j=G;if(!G&&k.minChars){l();return}if(y){y=clearTimeout(y)}if(I.which===13){if(I.preventDefault){I.preventDefault()}H=t.find("li.sel");if(!D&&!H.length){H=t.find("."+A+"-li:"+(k.putAbove?"last":"first")+"-child")}if(!D&&H.length){u.set(0,0,H.data(A+"-data"));p()}else{n=1;y=setTimeout(o,k.delay)}l()}else{if(q.val().length>=k.minChars){y=setTimeout(o,k.delay)}else{l()}}};s=function(D){D=D||window.event;if(!z){return true}var C=t.find("li.sel");if(!C.length){C=t.find("li:hover")}switch(D.which){case 38:C.removeClass("sel");if(D.preventDefault){D.preventDefault()}if(C.length&&C.prev().length){C.prev().addClass("sel")}else{t.find("ul li:last-child").addClass("sel")}break;case 40:C.removeClass("sel");if(D.preventDefault){D.preventDefault()}if(C.length&&C.next().length){C.next().addClass("sel")}else{t.find("ul li:first-child").addClass("sel")}break;case 27:case 9:l();break}};u.get=function(){var C=q.data(A+"-data");if(C&&C.key&&C.value){return C}};u.set=function(E,F,G,C){G=G||{key:E,value:F};var D,H=k.source;if(G.value&&G.key){q.val(G.value).data(A+"-data",G);(C||b.noop)()}else{if(G.key){G.value=G.key;q.val("...").data(A+"-data",G);if(b.isArray(H)){var I=false;for(D=0;D<H.length;D++){if(H[D].key===G.key){u.set(H[D].key,H[D].value);I=true;break}}if(!I){u.clear()}else{(C||b.noop)()}}else{H(G.key,null,function(J){if(J.length===1){J=x(J);u.set(0,0,J[0]);(C||b.noop)()}else{u.clear()}})}}else{q.data(A+"-data",null)}}};u.clear=function(){q.val("").data(A+"-data",null)};u.destroy=function(){t.remove();q.data(A+"-data",null).off("."+A)};u.on=function(C,D){v[C].push(D)};u.suggest=o;return w(i)};b.fn[a]=b.fn[a.toUpperCase()]=function(e){var d=this.data(a);if(!e||typeof e=="object"){return d||this.data(a,c(this,e))}else{if(!d){b.error('Cannot call "'+e+'" - Autosuggest not initialized.')}else{return d[e].apply(d,Array.prototype.slice.call(arguments,1))}}}}((window.FTB||{}).$||window.jQuery));